{% extends 'base.html' %}

{% block title %}Emotion Music Recommendation{% endblock %}

{% load static %}
<!-- Load CSS files -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous" />
<link href="https://fonts.googleapis.com/css2?family=Bigelow+Rules&display=swap" rel="stylesheet">

{% block content %}
<style>
    body {
        background: linear-gradient(to right, #030F12, #03181b);
        color: white;
    }

    h1 {
        font-family: 'Arial', sans-serif;
        color: #FFFFFF;
        font-size: 48px;
        font-weight: bold;
        text-shadow: 2px 2px 4px #000000;
        letter-spacing: 1px;
        text-align: center;
        margin-top: 50px;
    }

    h2 {
        font-family: 'Arial', sans-serif;
        color: rgba(255, 255, 255, 0.8);
        font-size: 32px;
        font-weight: normal;
        text-shadow: 1px 1px 3px #000000;
        letter-spacing: 0.5px;
        text-align: center;
        margin-top: 20px;
    }

    .table-wrapper {
        max-height: 400px;
        overflow-y: auto;
    }

    .table thead th {
        background-color: rgba(255, 255, 255, 0.1);
        color: #fff;
    }

    .control-btn {
        padding: 0.5rem 1rem;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .control-btn:first-child {
        background-color: #007bff;
        color: white;
    }

    .control-btn:last-child {
        background-color: #dc3545;
        color: white;
    }

    .control-btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
    }

    /* #model-stats {
        margin-top: 30px;
        text-align: center;
    } */
</style>

<div class="container mt-3">
    <h1>Emotion Music Recommender</h1>

    <div class="row mt-4">
        <!-- Camera Column -->
        <div class="col-md-6 mb-4">
            <div class="card bg-dark text-white">
                <div class="card-body">
                    <h2 class="card-title text-center">Live Emotion Detection</h2>
                    <img class="card-img-top mt-3" id="bg" src="" alt="Video Feed" style="display: none;" />
                    <div class="d-flex justify-content-center gap-3 mt-3">
                        <button id="startCapture" class="btn btn-primary">Start Camera</button>
                        <button id="stopCapture" class="btn btn-danger" disabled>Stop Camera</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Table Column -->
        <div class="col-md-6">
            <div class="card bg-dark text-white">
                <div class="card-body">
                    <h2 class="card-title text-center">Recommended Playlists</h2>
                    <div class="table-wrapper mt-3">
                        <table class="table table-dark table-hover">
                            <tbody id="ResultArea">
                                <!-- Table content will be dynamically inserted here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<section style="justify-content: center;align-items: center;">
    <!-- Navigation Buttons -->
    <div class="row mt-4">
        <div class="col text-center">
            <button class="btn btn-secondary me-2" onclick="window.location.reload();">
                <i class="fas fa-redo"></i> Refresh
            </button>
            <a href="{% url 'feedback' %}" class="btn btn-light">
                <i class="fa-regular fa-comment"></i> Feedbacks
            </a>
        </div>
    </div>
</section>

<!-- Model Statistics Section
<div id="model-stats">
    <h2>Model Statistics</h2>
    <pre id="stats-output"></pre>
    <button class="btn btn-info" onclick="fetchModelStats()">Show Model Stats</button>
</div> -->

<!-- Load JavaScript -->
<script>
    // Define the video feed URL from Django template
    const videoFeedUrl = "{% url 'video_feed' %}";

    function fetchModelStats() {
        fetch('/model_stats')
            .then(response => response.json())
            .then(data => {
                if (data.summary) {
                    document.getElementById('stats-output').innerText = data.summary;
                } else {
                    document.getElementById('stats-output').innerText = data.error;
                }
            })
            .catch(error => {
                console.error('Error fetching model stats:', error);
            });
    }
</script>
<script src="{% static 'js/index.js' %}"></script>

{% endblock %}
